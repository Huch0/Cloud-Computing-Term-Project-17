<!DOCTYPE html>
<html>

<head>
    <title>닮은꼴 찾기</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            color: #333;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #001f3f;
            /* 네이비 색상 */
            text-align: center;
        }

        input[type="file"] {
            display: block;
            margin: 10px auto;
            padding: 8px 20px;
        }

        button {
            margin: 30px auto 10px auto;
            background-color: #001f3f;
            /* 네이비 색상 */
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: block;
        }

        button:hover {
            background-color: #004f78;
        }

        .image-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        #uploadDisplay,
        #resultDisplay {
            margin: 0 50px;
            width: 300px;
            height: 300px;
            border: 3px solid #ccc;
            /* 회색 테두리 */
            background-color: #fff;
            /* 배경색을 흰색으로 설정 */
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #aaa;
            /* 연한 회색 텍스트 */
        }

        #result {
            margin: 20px auto;
            width: 300px;
            padding: 10px;
            border: 3px solid #ccc;
            /* 회색 테두리 */
            background-color: #fff;
            /* 배경색을 흰색으로 설정 */
            display: none;
        }
    </style>
</head>

<body>
    <h1>유명인 닮은꼴 찾기</h1>
    <input type="file" id="fileInput" accept="image/*" onchange="previewFile()">
    <div class="image-container">
        <div id="uploadDisplay">업로드한 사진이 여기에 표시됩니다.</div>
        <div id="resultDisplay">결과 사진이 여기에 표시됩니다.</div>
    </div>
    <div id="result">
        <p><span id="resultText"></span></p>
        <p>이름: <span id="celebrityName"></span></p>
        <p>유사도: <span id="matchConfidence"></span></p>
        <p>정보: <a id="infoUrl" href="" target="_blank"></a></p>
    </div>
    <button onclick="showResult()">결과 보기</button>

    <script>
        function previewFile() {
            const file = document.getElementById('fileInput').files[0];
            const reader = new FileReader();
            reader.onloadend = function () {
                document.getElementById('uploadDisplay').style.backgroundImage = 'url(' + reader.result + ')';
                document.getElementById('uploadDisplay').innerText = '';
            }
            if (file) {
                reader.readAsDataURL(file);
            }
        }
        function showResult() {
            if (document.getElementById('fileInput').files.length === 0) {
                alert('사진을 업로드해주세요.');
                return;
            }
            const resultImage = document.getElementById('resultDisplay');

            const formData = new FormData();
            formData.append('user_image', document.getElementById('fileInput').files[0]);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        resultImage.innerText = '오류가 발생했습니다.';
                        return;
                    }

                    response.json()
                        .then(data => {
                            console.log(data);

                            const result = document.getElementById('result');
                            const resultText = document.getElementById('resultText');
                            const celebrityName = document.getElementById('celebrityName');
                            const matchConfidence = document.getElementById('matchConfidence');
                            const infoUrl = document.getElementById('infoUrl');

                            result.style.display = 'block';

                            if (data.found == false) {
                                resultText.innerText = '유명인을 찾을 수 없습니다.';
                                celebrityName.innerText = '';
                                matchConfidence.innerText = '';
                                infoUrl.innerText = '';
                                infoUrl.href = '';
                                resultImage.style.backgroundImage = '';
                                resultImage.innerText = '결과 사진이 여기에 표시됩니다.';
                            } else {
                                resultText.innerText = '유명인을 찾았습니다.';
                                celebrityName.innerText = data.name;
                                matchConfidence.innerText = data.match_confidence + '%';

                                let url = data.info_url;
                                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                                    url = 'http://' + url;
                                }
                                console.log(url);

                                infoUrl.innerText = url;
                                infoUrl.href = url;

                                // Use the image URL to display the image
                                resultImage.style.backgroundImage = 'url(' + data.image + ')';
                                resultImage.innerText = '';
                            }
                        })
                        .catch(error => {
                            resultImage.innerText = '오류가 발생했습니다.';
                        });
                })
                .catch(error => {
                    resultImage.innerText = '오류가 발생했습니다.';
                });
        }
    </script>
</body>

</html>